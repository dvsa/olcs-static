<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for components/formHandler.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">components/formHandler.js</span></h1>
    <h2>
        Statements: <span class="metric">63.27% <small>(31 / 49)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">34.48% <small>(10 / 29)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">66.67% <small>(6 / 9)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">63.27% <small>(31 / 49)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">components/</a> &#187; formHandler.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var OLCS = OLCS || <span class="branch-1 cbranch-no" title="branch not covered" >{};</span>
&nbsp;
/**
 * Form handler
 *
 * A simple component to listen for form submissions and
 * make them asynchronous by using OLCS.submitForm to submit them.
 */
&nbsp;
OLCS.formHandler = (function(document, $, undefined) {
&nbsp;
  "use strict";
&nbsp;
  return function init(options) {
&nbsp;
    var selector = options.form;
    var isModal = options.isModal || false;
    var success = options.success;
&nbsp;
    // need the strict check because onChange can be passed in as false
    var onChange = options.onChange !== undefined ? <span class="branch-0 cbranch-no" title="branch not covered" >options.onChange </span>: function() {
      $(this).submit();
    };
&nbsp;
    var submitButton = options.submit || $(selector).find("[type=submit]");
    var actionSelector = selector + " [type=submit]";
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!success) {
      // if the user didn't pass a success callback then we assume they
      // used the filter &amp; container shorthand instead. As such, construct
      // a response filter (which internally normalises the response first)
      // to simply replace the container with the new filtered HTML
      success = OLCS.filterResponse(options.filter, options.container);
    }
&nbsp;
    // we'll return this so consumers can unbind listeners if they want to
    var handler = {
      unbind: function() {
        /**
         * @NOTE: it is crucial that *all* listeners are unbound here, so
         * when adding any `on` calls, make sure you add the
         * corresponding `off` too
         */
        $(document).off("submit", selector);
&nbsp;
        $(document).off("click", actionSelector);
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>if (onChange) {
          $(document).off("change", selector);
        }
      }
    };
&nbsp;
    var F = OLCS.formHelper;
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>if (options.hideSubmit) {
      $(submitButton).hide();
    }
&nbsp;
    <span class="missing-if-branch" title="else path not taken" >E</span>if (onChange) {
      $(document).on("change", selector, function(e) {
        var form = $(selector);
        onChange.call(form, e);
      });
    }
&nbsp;
    // we need to hook into click events to make sure we set the
    // correct input name when submitting the form via AJAX. Normally
    // these don't get set, but some backend logic acts based on
    // which button was clicked
    $(document).on("click", actionSelector, <span class="fstat-no" title="function not covered" >function(e) {</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      var form   = $(this).parents(selector);</span>
<span class="cstat-no" title="statement not covered" >      var button = $(this);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >      F.pressButton(form, button);</span>
&nbsp;
      // don't interfere with a normal submit on a multipart form; remove
      // the submit handler and let the click event happen normally
<span class="cstat-no" title="statement not covered" >      if (form.attr("enctype") === "multipart/form-data") {</span>
&nbsp;
        // got any file inputs populated?
<span class="cstat-no" title="statement not covered" >        var isDirty = false;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        $.each(form.find("input[type=file]"), <span class="fstat-no" title="function not covered" >function(i, e) {</span></span>
<span class="cstat-no" title="statement not covered" >          if ($(e).val() !== "") {</span>
<span class="cstat-no" title="statement not covered" >            isDirty = true;</span>
          }
        });
&nbsp;
        // if the user has pressed upload we *always* want to unbind
        // otherwise if any file inputs have values and the form has been
        // submitted, unbind too
<span class="cstat-no" title="statement not covered" >        if (F.buttonPressed(form, "[upload]") || (isDirty &amp;&amp; F.buttonPressed(form, "[submit]"))) {</span>
<span class="cstat-no" title="statement not covered" >          handler.unbind();</span>
<span class="cstat-no" title="statement not covered" >          return;</span>
        }
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      e.preventDefault();</span>
&nbsp;
      // make sure we don't try and submit cancel buttons
<span class="cstat-no" title="statement not covered" >      if (isModal &amp;&amp; F.buttonPressed(form, "[cancel]")) {</span>
<span class="cstat-no" title="statement not covered" >        OLCS.eventEmitter.emit("modal:cancel");</span>
<span class="cstat-no" title="statement not covered" >        OLCS.logger.debug("trapped 'cancel' click inside modal, won't submit form", "formHandler");</span>
<span class="cstat-no" title="statement not covered" >        return;</span>
      }
&nbsp;
<span class="cstat-no" title="statement not covered" >      form.submit();</span>
    });
&nbsp;
    // bind a simple submit handler to send the form via * AJAX
    $(document).on("submit", selector, function(e) {
      e.preventDefault();
&nbsp;
      OLCS.logger.debug("submitting form '" + selector + "'", "formHandler");
&nbsp;
      var form = $(this);
&nbsp;
      OLCS.submitForm({
        form: form,
        success: success,
        disable: options.disable,
        complete: <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >          OLCS.eventEmitter.emit("update:" + options.container);</span>
        }
      });
    });
&nbsp;
    // callers of this component might want to manually unbind the listeners
    // we've bound to it, so we need to return a wrapped object which lets
    // them do so
    return handler;
  };
&nbsp;
}(document, window.jQuery));
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu May 26 2016 11:55:54 GMT+0100 (BST)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
